<?xml version="1.0" encoding="utf-8" ?>
<Page xmlns="http://schemas.nativescript.org/tns.xsd" navigatingTo="onNavigatingTo">
    <ActionBar title="My Matches">
        <NavigationButton text="Back" android.systemIcon="ic_menu_back" />
    </ActionBar>

    <GridLayout rows="auto, *">
        <!-- Filters -->
        <GridLayout row="0" columns="*, *, *" class="filter-bar" padding="10">
            <Button col="0" text="Upcoming" 
                    tap="{{ filterMatches }}" 
                    class="{{ filter === 'upcoming' ? 'filter-active' : 'filter' }}" 
                    data-filter="upcoming" />
            <Button col="1" text="Active" 
                    tap="{{ filterMatches }}" 
                    class="{{ filter === 'active' ? 'filter-active' : 'filter' }}" 
                    data-filter="active" />
            <Button col="2" text="Completed" 
                    tap="{{ filterMatches }}" 
                    class="{{ filter === 'completed' ? 'filter-active' : 'filter' }}" 
                    data-filter="completed" />
        </GridLayout>

        <!-- Matches List -->
        <GridLayout row="1" rows="auto, *">
            <!-- Loading Indicator -->
            <ActivityIndicator row="0" busy="{{ isLoading }}" 
                             visibility="{{ isLoading ? 'visible' : 'collapsed' }}" />

            <!-- Matches ListView -->
            <ListView row="1" items="{{ matches }}" itemTap="{{ onMatchTap }}" class="match-list"
                     pullToRefresh="true" @pullToRefreshInitiated="{{ onPullToRefresh }}">
                <ListView.itemTemplate>
                    <GridLayout columns="*, auto" rows="auto, auto, auto" class="match-item" padding="15">
                        <!-- Tournament Info -->
                        <Label col="0" row="0" text="{{ tournament.title }}" class="tournament-title" />
                        <Label col="1" row="0" text="{{ status }}" class="match-status-{{ status }}" />
                        
                        <!-- Players -->
                        <GridLayout col="0" colSpan="2" row="1" rows="auto" columns="*, auto, *" marginTop="10">
                            <StackLayout col="0">
                                <Label text="{{ player1.username }}" class="player-name" />
                                <Label text="{{ player1.game_id }}" class="game-id" />
                                <Label text="{{ player1_score }}" class="score" 
                                       visibility="{{ status === 'completed' ? 'visible' : 'collapsed' }}" />
                            </StackLayout>
                            <Label col="1" text="vs" class="vs-text" />
                            <StackLayout col="2">
                                <Label text="{{ player2.username }}" class="player-name" />
                                <Label text="{{ player2.game_id }}" class="game-id" />
                                <Label text="{{ player2_score }}" class="score"
                                       visibility="{{ status === 'completed' ? 'visible' : 'collapsed' }}" />
                            </StackLayout>
                        </GridLayout>

                        <!-- Match Time -->
                        <Label col="0" colSpan="2" row="2" text="{{ scheduled_time, 'Match starts: ' + scheduled_time | dateFormat }}" 
                               class="match-time" marginTop="5" />
                    </GridLayout>
                </ListView.itemTemplate>
            </ListView>

            <!-- Empty State -->
            <StackLayout row="1" visibility="{{ !isLoading && (!matches || matches.length === 0) ? 'visible' : 'collapsed' }}"
                        horizontalAlignment="center" verticalAlignment="center">
                <Label text="No matches found" class="empty-message" />
                <Label text="Join tournaments to participate in matches" class="empty-submessage" textWrap="true" />
            </StackLayout>
        </GridLayout>
    </GridLayout>
</Page>
