<Page xmlns="http://schemas.nativescript.org/tns.xsd" navigatingTo="onNavigatingTo" class="page">
    <ActionBar title="Reset Password" class="action-bar">
        <NavigationButton visibility="visible" tap="{{ goBack }}" />
    </ActionBar>

    <StackLayout class="p-20">
        <!-- Request Reset Form -->
        <StackLayout visibility="{{ !showNewPasswordForm ? 'visible' : 'collapsed' }}">
            <Label text="Enter your email address to reset your password" textWrap="true" class="h2" />
            
            <Label text="Email" class="input-label" />
            <TextField text="{{ email }}" 
                      hint="Enter your email" 
                      keyboardType="email" 
                      autocorrect="false" 
                      autocapitalizationType="none" 
                      class="input" />
            <Label text="{{ emailError }}" class="error-text" visibility="{{ emailError ? 'visible' : 'collapsed' }}" />

            <Button text="Send Reset Link" 
                    tap="{{ sendResetLink }}" 
                    isEnabled="{{ !isLoading }}" 
                    class="btn btn-primary m-t-20" />
        </StackLayout>

        <!-- New Password Form -->
        <StackLayout visibility="{{ showNewPasswordForm ? 'visible' : 'collapsed' }}">
            <Label text="Enter your new password" textWrap="true" class="h2" />
            
            <Label text="New Password" class="input-label" />
            <TextField text="{{ newPassword }}" 
                      hint="Enter new password" 
                      secure="true" 
                      class="input" />
            <Label text="{{ newPasswordError }}" class="error-text" visibility="{{ newPasswordError ? 'visible' : 'collapsed' }}" />

            <Label text="Confirm Password" class="input-label" />
            <TextField text="{{ confirmPassword }}" 
                      hint="Confirm new password" 
                      secure="true" 
                      class="input" />
            <Label text="{{ confirmPasswordError }}" class="error-text" visibility="{{ confirmPasswordError ? 'visible' : 'collapsed' }}" />

            <Button text="Update Password" 
                    tap="{{ updatePassword }}" 
                    isEnabled="{{ !isLoading }}" 
                    class="btn btn-primary m-t-20" />
        </StackLayout>

        <ActivityIndicator busy="{{ isLoading }}" class="activity-indicator" />
        
        <Label text="{{ errorMessage }}" 
               class="error-text text-center" 
               textWrap="true"
               visibility="{{ errorMessage ? 'visible' : 'collapsed' }}" />
    </StackLayout>
</Page>
